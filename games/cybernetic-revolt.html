<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cybernetic Revolt</title>
    <style>
        body { margin: 0; background: #050510; overflow: hidden; font-family: 'Courier New', monospace; color: #0ff; }
        #gameCanvas { display: block; width: 100%; height: 100%; }
        #ui { position: absolute; top: 20px; left: 20px; font-size: 24px; text-shadow: 0 0 5px #0ff; pointer-events: none; }
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; z-index: 10; }
        .hidden { display: none !important; }
        h1 { font-size: 48px; color: #00e5ff; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 5px; text-shadow: 0 0 20px #00e5ff; }
        button { background: transparent; border: 2px solid #00e5ff; padding: 15px 40px; color: #00e5ff; font-size: 20px; cursor: pointer; transition: all 0.3s; font-family: 'Courier New', monospace; text-transform: uppercase; font-weight: bold; }
        button:hover { background: #00e5ff; color: #000; box-shadow: 0 0 20px #00e5ff; }

        .touch-controls { display: none; position: absolute; bottom: 30px; left: 0; width: 100%; padding: 0 40px; justify-content: space-between; box-sizing: border-box; pointer-events: none; z-index: 5; }
        .btn { width: 80px; height: 80px; background: rgba(0, 229, 255, 0.1); border: 2px solid #00e5ff; border-radius: 50%; color: #00e5ff; font-size: 24px; display: flex; justify-content: center; align-items: center; pointer-events: auto; user-select: none; }
        .btn:active { background: rgba(0, 229, 255, 0.4); }

        @media (max-width: 768px) { .touch-controls { display: flex; } }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="ui">DISTANCE: <span id="score">0</span>m</div>

    <div class="touch-controls">
        <div class="btn" id="btnJump">JUMP</div>
        <div class="btn" id="btnShoot">FIRE</div>
    </div>

    <div id="startScreen" class="screen">
        <h1>Cybernetic Revolt</h1>
        <p>Escape the City. Destroy the Drones.</p>
        <p>JUMP: Up Arrow / Space<br>SHOOT: X / Click</p>
        <button id="startBtn">INITIATE RUN</button>
    </div>

    <div id="gameOverScreen" class="screen hidden">
        <h1 style="color: #ff3333; text-shadow: 0 0 20px #ff3333;">SYSTEM FAILURE</h1>
        <p>DISTANCE: <span id="finalScore">0</span>m</p>
        <button id="restartBtn">REBOOT</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let gameRunning = false;
        let score = 0;
        let lastTime = 0;

        // Physics
        const GRAVITY = 1500;
        const JUMP_FORCE = -700;
        const GROUND_Y = 100; // from bottom

        let player = { x: 100, y: 0, width: 40, height: 60, vy: 0, grounded: false, color: '#00e5ff' };
        let obstacles = [];
        let bullets = [];
        let particles = [];
        let gameSpeed = 300;

        const keys = {};

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            player.groundY = canvas.height - GROUND_Y;
        }
        window.addEventListener('resize', resize);
        resize();

        function init() {
            score = 0;
            gameSpeed = 300;
            player.y = player.groundY - player.height;
            player.vy = 0;
            obstacles = [];
            bullets = [];
            particles = [];

            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            gameRunning = true;
            lastTime = performance.now();
            requestAnimationFrame(loop);
        }

        function update(dt) {
            // Update Score
            score += gameSpeed * dt * 0.1;
            gameSpeed += 5 * dt;
            document.getElementById('score').innerText = Math.floor(score);

            // Player Physics
            player.vy += GRAVITY * dt;
            player.y += player.vy * dt;

            if (player.y >= player.groundY - player.height) {
                player.y = player.groundY - player.height;
                player.vy = 0;
                player.grounded = true;
            } else {
                player.grounded = false;
            }

            // Jump
            if ((keys['ArrowUp'] || keys[' '] || keys['w']) && player.grounded) {
                player.vy = JUMP_FORCE;
                player.grounded = false;
                createDust(player.x + player.width/2, player.y + player.height);
            }

            // Shoot
            if (keys['x'] || keys['Click']) {
                if (!keys.fired) {
                    shoot();
                    keys.fired = true;
                }
            } else {
                keys.fired = false;
            }

            // Bullets
            for (let i = bullets.length - 1; i >= 0; i--) {
                const b = bullets[i];
                b.x += b.speed * dt;
                if (b.x > canvas.width) bullets.splice(i, 1);
            }

            // Spawn Obstacles
            if (obstacles.length === 0 || canvas.width - obstacles[obstacles.length-1].x > 400 + Math.random() * 400) {
                spawnObstacle();
            }

            // Update Obstacles
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const ob = obstacles[i];
                ob.x -= gameSpeed * dt;

                // Collision Player
                if (checkCollide(player, ob)) {
                    createExplosion(player.x, player.y, '#00e5ff');
                    gameOver();
                }

                // Collision Bullet (only if destroyable)
                if (ob.type === 'drone') {
                    for (let j = bullets.length - 1; j >= 0; j--) {
                        if (checkCollide(bullets[j], ob)) {
                            createExplosion(ob.x, ob.y, '#ff3333');
                            obstacles.splice(i, 1);
                            bullets.splice(j, 1);
                            score += 50;
                            break;
                        }
                    }
                }

                if (ob.x + ob.width < 0) obstacles.splice(i, 1);
            }

            // Particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.life -= dt;
                p.x += p.vx * dt;
                p.y += p.vy * dt;
                if (p.life <= 0) particles.splice(i, 1);
            }
        }

        function draw() {
            // Background (Cyberpunk city simplified)
            ctx.fillStyle = '#050510';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Distant buildings
            ctx.fillStyle = '#0a0a20';
            for (let i = 0; i < 20; i++) {
                const h = 100 + Math.sin(i * 132) * 50;
                const x = (i * 100 - (score * 0.2) % 2000);
                if (x > -100 && x < canvas.width)
                    ctx.fillRect(x, canvas.height - GROUND_Y - h, 80, h);
            }

            // Ground
            ctx.fillStyle = '#00e5ff';
            ctx.fillRect(0, canvas.height - GROUND_Y, canvas.width, 10);
            ctx.fillStyle = '#003344';
            ctx.fillRect(0, canvas.height - GROUND_Y + 10, canvas.width, canvas.height);

            // Player
            ctx.fillStyle = player.color;
            ctx.shadowBlur = 10;
            ctx.shadowColor = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            // Visor
            ctx.fillStyle = '#fff';
            ctx.fillRect(player.x + 25, player.y + 10, 15, 5);
            ctx.shadowBlur = 0;

            // Obstacles
            obstacles.forEach(ob => {
                ctx.fillStyle = ob.color;
                ctx.shadowBlur = 10;
                ctx.shadowColor = ob.color;
                ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
                ctx.shadowBlur = 0;
                if (ob.type === 'drone') {
                    // Eye
                    ctx.fillStyle = '#ff0000';
                    ctx.fillRect(ob.x + 5, ob.y + 10, 5, 5);
                }
            });

            // Bullets
            ctx.fillStyle = '#fff';
            bullets.forEach(b => ctx.fillRect(b.x, b.y, b.width, b.height));

            // Particles
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            });
            ctx.globalAlpha = 1.0;
        }

        function loop(timestamp) {
            if (!gameRunning) return;
            const dt = (timestamp - lastTime) / 1000;
            lastTime = timestamp;
            update(Math.min(dt, 0.1));
            draw();
            requestAnimationFrame(loop);
        }

        function shoot() {
            bullets.push({
                x: player.x + player.width,
                y: player.y + 20,
                width: 20,
                height: 5,
                speed: 1000
            });
        }

        function spawnObstacle() {
            const type = Math.random() > 0.5 ? 'drone' : 'box';
            if (type === 'drone') {
                // Flying enemy (shootable)
                obstacles.push({
                    x: canvas.width,
                    y: player.groundY - 100 - Math.random() * 100,
                    width: 40,
                    height: 30,
                    type: 'drone',
                    color: '#ff3333'
                });
            } else {
                // Ground obstacle (jump over)
                obstacles.push({
                    x: canvas.width,
                    y: player.groundY - 50,
                    width: 40,
                    height: 50,
                    type: 'box',
                    color: '#888'
                });
            }
        }

        function checkCollide(r1, r2) {
            return r1.x < r2.x + r2.width &&
                   r1.x + r1.width > r2.x &&
                   r1.y < r2.y + r2.height &&
                   r1.y + r1.height > r2.y;
        }

        function createExplosion(x, y, color) {
            for (let i = 0; i < 20; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 500,
                    vy: (Math.random() - 0.5) * 500,
                    life: 0.5 + Math.random(),
                    color: color,
                    size: Math.random() * 5 + 2
                });
            }
        }

        function createDust(x, y) {
             for (let i = 0; i < 5; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 100,
                    vy: -Math.random() * 50,
                    life: 0.3 + Math.random() * 0.2,
                    color: '#aaa',
                    size: Math.random() * 4 + 2
                });
            }
        }

        function gameOver() {
            gameRunning = false;
            document.getElementById('finalScore').innerText = Math.floor(score);
            document.getElementById('gameOverScreen').classList.remove('hidden');
        }

        // Inputs
        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);

        document.getElementById('startBtn').addEventListener('click', init);
        document.getElementById('restartBtn').addEventListener('click', init);

        // Touch
        const btnJump = document.getElementById('btnJump');
        const btnShoot = document.getElementById('btnShoot');

        function addTouch(elem, key) {
             elem.addEventListener('touchstart', e => { e.preventDefault(); keys[key] = true; });
             elem.addEventListener('touchend', e => { e.preventDefault(); keys[key] = false; });
        }
        addTouch(btnJump, ' ');
        addTouch(btnShoot, 'Click'); // mapped to custom key

        resize();
        draw();
    </script>
</body>
</html>
